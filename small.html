<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Small Test</title>
  <script src="https://openseadragon.github.io/openseadragon/openseadragon.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/tdiprima/OpenseadragonFabricjsOverlay/fabric/fabric.adapted.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/tdiprima/OpenseadragonFabricjsOverlay/openseadragon-fabricjs-overlay.js">
  </script>
  <!-- <link href="https://cdn.jsdelivr.net/gh/openseadragon/openseadragon.github.com/css/style.css" rel="stylesheet"> -->
  <script crossorigin="anonymous" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
          src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <style>
    .element {
      float: left;
    }
  </style>

  <script>
    let viewer, srcWidth, srcHeight
    let updateViewerSize = function (maxWidth, maxHeight) {
      let fit = calculateAspectRatioFit(srcWidth, srcHeight, maxWidth, maxHeight)
      console.log(fit)
      $('#osd').attr('style', 'width: ' +
        fit.width + 'px;' + 'height: ' +
        fit.height + 'px; border: blueviolet 1px solid')

      if (maxWidth < 500) {
        // Not working.
        // viewer.setControlsEnabled(false)
        viewer.showNavigationControl = false
        // viewer.showHomeControl = false
      }
    }
  </script>

</head>

<body>
<div class="element">
  <div id="osd" style="width: 800px; height: 600px; border: 1px solid blueviolet;"></div>
</div>
<div class="element">
  width x height<br>
  <button id="btn1" onclick="updateViewerSize(800, 600)">800 x 600</button>
  <br>
  <button id="btn2" onclick="updateViewerSize(640, 480)">640 x 480</button>
  <br>
  <button id="btn3" onclick="updateViewerSize(200, 200)">200 x 200</button>
  <br><br>
  <button id="btn4" onclick="updateViewerSize(100, 100)">100 x 100</button>
  <br><br>
  <button id="btnZoom" onclick="zoom()">zoom to center</button>
</div>
<script>
  viewer = new OpenSeadragon({
    id: 'osd',
    prefixUrl: '//openseadragon.github.io/openseadragon/images/',
    tileSources: '//openseadragon.github.io/example-images/duomo/duomo.dzi'
  })

  viewer.addHandler('open', function () {
    srcHeight = (viewer.world.getItemAt(0).source.dimensions.y / window.devicePixelRatio)
    srcWidth = (viewer.world.getItemAt(0).source.dimensions.x / window.devicePixelRatio)
    updateViewerSize(800, 600)
  })

  let zoom = function () {
    let center = new OpenSeadragon.Point(srcWidth / 2, srcHeight / 2)
    console.log('center', center)
    let point = viewer.viewport.imageToViewportCoordinates(center)
    viewer.viewport.panTo(new OpenSeadragon.Point(point.x, point.y))
    viewer.viewport.zoomTo(viewer.viewport.getMaxZoom())
  }

  function calculateAspectRatioFit (srcWidth, srcHeight, maxWidth, maxHeight) {
    let ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight)
    return {
      width: Math.round(srcWidth * ratio),
      height: Math.round(srcHeight * ratio)
    }
  }

</script>

</body>

</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Testing</title>
  <style> body { margin: 0; } </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="/multi-viewer/css/main.min.css">
</head>

<body>
  <script type="importmap">
    {
        "imports": {
            "three": "/threejs/build/three.module.js",
            "three/addons/": "/threejs/examples/jsm/",
            "zephyr": "/zephyr/rapture.js"
        }
    }
  </script>
  <script type="module">
    import * as THREE from 'three';
    import Stats from 'three/addons/libs/stats.module.js';
    import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
    import { TrackballControls } from 'three/addons/controls/TrackballControls.js';
    import * as ZEPHYR from 'zephyr';
    import { enableDrawing } from './drawingModule.js';
    // import { polygons } from './polygons.js';
    import { polygons } from './polygons1.js';
    // import { ruler } from './ruler.js';

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      renderer.setSize(window.innerWidth, window.innerHeight);
      camera.updateProjectionMatrix();
    }

    THREE.Cache.enabled = true;
    const scene = new THREE.Scene();

    const camera = new THREE.PerspectiveCamera(90, window.innerWidth / window.innerHeight, 0.1, 12000);
    camera.position.set(0, 0, 11000);
    camera.lookAt(new THREE.Vector3(0, 0, 0));
    scene.add(camera);

    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    window.addEventListener('resize', onWindowResize);
    let controls = new TrackballControls(camera, renderer.domElement);
    ZEPHYR.CreateImageViewer(scene, "https://beak.bmi.stonybrook.edu:8890/iiif/?iiif=https://beak.bmi.stonybrook.edu:8890/Storage/images/tcga_data/brca/TCGA-E2-A15K-06A-01-TS1.svs", 0);

    // Enable drawing on the scene
    enableDrawing(scene, camera, renderer, controls);
    polygons(scene, camera, renderer, controls);
    // ruler(scene, camera, renderer, controls);

    function animate() {
      controls.update();
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }

    animate();
  </script>
</body>
</html>

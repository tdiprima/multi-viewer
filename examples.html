<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>EXAMPLES</title>
  <script crossorigin="anonymous"
          integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
          src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://openseadragon.github.io/openseadragon/openseadragon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/usnistgov/OpenSeadragonFiltering/openseadragon-filtering.js"></script>
  <script src="src/imageFiltering.js"></script>
  <script src="src/ImageViewer.js"></script>
  <script src="src/MultiViewer.js"></script>
  <script src="src/iiifUrlParser.js"></script>
  <script src="src/roiAlchemy.js"></script>
</head>

<body>
<h3 id="info"></h3>
<div id="contentDiv" style="width: 640px; height: 480px;"></div>
<script>
  let info = document.getElementById('info')
  // let baseImage = '//openseadragon.github.io/example-images/duomo/duomo.dzi'
  // let baseImage = window.location.origin + '/iiif/?iiif=/tcgaseg/tcgaimages/blca/TCGA-2F-A9KO-01Z-00-DX1.195576CF-B739-4BD9-B15B-4A70AE287D3E.svs/info.json'
  let baseImage = window.location.origin + '/iiif/?iiif=/tcgaseg/tcgaimages/blca/TCGA-4Z-AA7N-01Z-00-DX1.10AA3499-6678-4DB2-9466-9CB3EA25CBB6.svs/info.json'

  function zoomInOnRegionsOfInterest(image) {
    info.innerHTML = 'Zoom in on Different Regions of Interest'
    const regions = ['/0,0,2784,2784/max/0/default.jpg',
      '/2784,2784,2784,2784/max/0/default.jpg',
      '/2000,2000,2000,2000/max/0/default.jpg',
      '/4000,4000,4000,4000/max/0/default.jpg']
    roiAlchemy('contentDiv', image, regions, 2, 2, 500, 300)
  }

  // zoomInOnRegionsOfInterest(baseImage)

  function fit_roi_to_viewport(image) {
    info.innerHTML = 'Fit ROI to Viewport'
    let viewer = OpenSeadragon({
      id: 'contentDiv',
      tileSources: image,
      prefixUrl: 'vendor/openseadragon/images/',
      crossOriginPolicy: 'Anonymous'
    })

    viewer.addHandler('open', function () {
      let rect = new OpenSeadragon.Rect(0.2, 0.2, 0.2, 0.2)
      let elt = document.createElement("div")
      elt.id = "runtime-overlay"
      // elt.className = "highlight"
      elt.style.background = 'black'
      viewer.addOverlay({
        element: elt,
        location: rect
      })
      setTimeout(function () {
        viewer.viewport.fitBounds(rect)
      }, 1000)
    })

  }

  // fit_roi_to_viewport(baseImage)

  // Display one OSD viewer
  function testImageViewer(baseImage) {
    info.innerHTML = 'Display an Image Using ImageViewer'
    new ImageViewer(0, 'contentDiv', baseImage)
  }

  // testImageViewer(baseImage)

  // Testing ONE viewer, using MultiViewer.
  function testMultiViewer(baseImage) {
    info.innerHTML = 'Display an Image Using MultiViewer'
    new MultiViewer(1, 'contentDiv', baseImage)
  }

  // testMultiViewer(baseImage)

  // Testing multiple layers, using MultiViewer.
  // NOTE! We do not currently have > 1 overlay, so I'm using an overlay from a different slide as the 2nd overlay.
  function multiFeatures() {
    // BLCA
    let s1 = 'TCGA-2F-A9KO-01Z-00-DX1.195576CF-B739-4BD9-B15B-4A70AE287D3E'
    let s2 = 'TCGA-2F-A9KP-01Z-00-DX1.3CDF534E-958F-4467-AA7E-FD3C5A86AAAA'
    let base = buildAUrl('image', 'blca', s1)
    let f1 = buildAUrl('feature', 'blca', s1)
    let f2 = buildAUrl('feature', 'blca', s2)
    // BRCA
    // let s1 = 'TCGA-3C-AALI-01Z-00-DX1.F6E9A5DF-D8FB-45CF-B4BD-C6B76294C291'
    // let s2 = 'TCGA-3C-AALJ-01Z-00-DX1.777C0957-255A-42F0-9EEB-A3606BCF0C96'
    // let base = buildAUrl('image', 'brca', s1)
    // let f1 = buildAUrl('feature', 'brca', s1)
    // let f2 = buildAUrl('feature', 'brca', s2)
    let features = [[f1, f2]]
    info.innerHTML = 'Display Multiple Features'
    new ImageViewer(1, 'contentDiv', base, features)
  }

  multiFeatures()

  function buildAUrl(type, cType, img) {

    if (type === 'image') {
      return window.location.origin + '/iiif/?iiif=/tcgaseg/tcgaimages/' + cType + '/' + img + '.svs/info.json'
    } else if (type === 'feature') {
      return window.location.origin + '/iiif/?iiif=/tcgaseg/featureimages/' + cType + '/' + img + '-featureimage.tif/info.json'
    } else {
      return ''
    }

  }

</script>
</body>

</html>
